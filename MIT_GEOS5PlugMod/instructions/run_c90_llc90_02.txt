# Checkout code as per instructions in checkout.txt

# Location of GEOSenv module on Discover
# module use -a /discover/swdev/gmao_SIteam/modulefiles-SLES12

# Location of GEOSenv module on NAS
  module use -a /nobackup/gmao_SIteam/modulefiles

# Load GEOSenv module
  module load GEOSenv

# Build make files
  tcsh
  cd GEOSgcm
  source @env/g5_modules
  mkdir build
  cd build
  cmake .. -DBASEDIR=$BASEDIR/Linux -DCMAKE_INSTALL_PREFIX=../install -DBUILD_MIT_OCEAN=ON -DCMAKE_Fortran_COMPILER=ifort -DMIT_CONFIG_ID=c90_llc90_02
# For debug, add: -DCMAKE_BUILD_TYPE=Debug

# Compile code
  make -j 12 install

# To recompile MITgcm only:
# rm -rf src/Components/@GEOSgcm_GridComp/GEOSogcm_GridComp/GEOS_OceanGridComp/MIT_GEOS5PlugMod

# Run the setup script
  cd ../../GEOSgcm/install/bin
  ./gcm_setup

# Sample answers:
  run_checkpoint68o
  GEOS-ECCO configuration with ECCO-v4r4 set-up and MITgcm checkpoint68o
  NO (default)
  c90
  72 (default)
  MG1
  TRUE (default)
  NO (default)
  sky (default)
  YES
  MIT
  llc90 (default)
  50 (default)
  2  (default)
  1 (default)
  A (default)
  MERRA2 (Default)
  ENTER to use Default Location: (Current) for HISTORY, HOME, EXPERIMENT, Build
  s1353 (my default, if not enter valid gid)

# Prepare experiment in EXPERIMENT directory
# Copy mit_input directory and contents
# (be sure to replace GEOSDIR below with your own GEOSDIR)
# (eventually this should be included in the gcm_run.j script)
  setenv GEOSDIR /nobackupp17/dmenemen/Jason/checkpoint68o/GEOSgcm/install 
  setenv GEOSgcm $GEOSDIR/../src/Components/@GEOSgcm_GridComp
  setenv MITplug $GEOSgcm/GEOSogcm_GridComp/GEOS_OceanGridComp/MIT_GEOS5PlugMod/
  setenv MITinput $MITplug/configs/c90_llc90_02/input/
  mkdir mit_input
  cd mit_input
  ln -s /nobackup/hzhang1/pub/Release4/input_bin/* .
  cp $MITinput/* .
  cd ..

# Copy restarts-orig  contents for GEOS restarts into main exp directory
  cp -r /nobackup/afahad/GEOSMITgcmFiles/restarts-orig/* .	

# Replace HISTORY.rc - essentially grab the one from /nobackup/afahad/GEOSMITgcmFiles/HISTORY.rc
# Just retain the exp name and description from new exp.

# Replace nobackupp18 with nobackupp17 in gcm_run.j

# Go
  qsub gcm_run.j
